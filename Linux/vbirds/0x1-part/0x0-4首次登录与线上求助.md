# 第一部分 第四章

## 1、首次登入系统

因为linux是多用户操作系统，所以系统随时都可能有很多不同用户下达任务，这时候的关机是很重要的，因为如果别人正在编辑文件而你关机了，可能会造成数据丢失。  

### GNOME的操作与登出

在每一个用户第一次以图形界面登入系统是，系统都会询问使用者的操作焊接，以一句使用者的国际、语言与区域等制定与系统预设值不同的环境。  

用户登出-并不是关机，只是用户离开系统而已  

### X window与文字模式的切换

我们通常称文字模式为：终端机界面、terminal、console  
Linux预设的情况下回提供六个terminal来让使用者登入  
切换的方式使用：`ctrl + alt + F1-F6`  
系统会将F1-F6命名为tty1-tty6的操作界面环境  

值得注意的是，你在那个tty输入`startx`就会在那个tty内启动X window  

### 在终端登录linux

随便进入一个不是xwindow的tty，会显示如下代码：

```
CentOS Linux 7 (core):		#显示linux distribution额蒙城（centos）与版本
Kernel 3.10.0-299.e17.x86_64 on an x86_64: 		#显示linux的核心版本号和主机的硬件等级为x86_64
study login: #这里的study是主机名，login就是登录了
Password:		#输入密码（这里不会显示任何信息）
Last login: 		#显示上次这个账号登入系统的时间
[dmtsai@study~]$_:	#这里的dmtsai是目前使用的账号，@后面的是主机名，再后面的是当前路径，最后的$是提示字符

Tps：root的提示字符是#；普通用户的提示字符是$
```

强烈建议建立一个普通用户来使用电脑，因为root的权限实在是太大了，

输入exit 当前账号登出系统  

## 2、文字模式下指令的下达

### 开始下达指令

`command [-options] parameter1 parameter2 ...`  
`指令	选项	参数1	参数2	。。。`  

- 0.一行指令中第一个输入的部分绝对是【指令（command）】或【可执行档案（例如批次脚本,script）】  
- 1.command为指令的名称，例如变换工作路径的指令为cd等等  
- 2.中括号【】并不存在与实际的指令中，而加入选项设定时，通常选项前就会带`-`号，例如`h`;有时候会使用选项的完整全名，则玄子昂前带有`--`符号，例如`--help`  
- 3.parameter1 parameter2 ...为衣服在选项后面的参数，或者是command的参数  
- 4.指令，选项，参数等这几个东东中间以空格区分，不论空几格shell都视为一格。**所以空格是很重要的特殊字符！**  
- 5.按下enter键后，该指令就立即执行。**enter按键代表着一行指令的开始启动**  
- 6.指令太长的时候，可以使用反斜杠`\`来跳脱`enter`符号，使指令连续到下一行。**注意：反斜杠后就立刻接特殊最`才可以跳脱** (这个注意感觉有些系统里面有没有都无所谓） 
- 7.其他：
	- 在linux系统中，英文大小写字母是不一样的
	- 更多的需要在第十章bash时才能学到。

**第一个被输入的资料觉对是指令或者是可执行的档案**这是很重要的概念，还有按下Enter键表示要开始执行此一行命令的意思  
在linux环境中**大小写字母是不一样的东西**  

### 语系的支持

`locale`命令可以显示语言语系的输出，咨询的输出使用的语系，时间方面的语系资料，全部的资料同步更新的设定值。。。  
`date`显示时间，可能有乱码，意味命令行界面无法显示中文，所以是乱码  
`LANG=en_US.utf8`  
`ecport LC_ALL=en_US.utf8`  
以上两行为，修改语系为英语系，LANG只和输出信息有关，弱需要更改其他不同的资讯，要同步更新 LC_ALL才行。  

### 基础指令的操作

- 显示日期与时间的指令：date
- 显示日历的指令：cal
- 简单好用的计算机：bc

----

**date**

如果想要在命令行显示linux系统时间，直接输入date即可  
CST是时区，中国东部应该是在CST时区的（不太懂，不深究）  
dae的格式化输出：  

```
date +%Y/%m/%d
2019/11/01
date +%H:%M
19:34
```

从上面的例子中我们可以知道，指令之后的选项除了前面带有减号`-`之外，某些特殊情况下，选项或参数前面也会带有正号`+`的情况。  

----

**cal**

如果我们想要显示当前月份，直接输入cal即可。  

`cal [month] [year]`  

如果我们在month的位置输入13，程序就会报错，所以，某些指令由特殊参数存在，若输入错误的参数，则该指令会有错误信息的提示，透过这个提示我们可以藉以了解指令下达错误之处。  

---- 

简单好用的计算机：bc  

输入bc后就会进入bc界面，当然输入的资料也得要符合bc的要求才行。  

- 几个简单的运算符：
	- + 加法
	- - 减法
	- * 乘法
	- / 除法
	- ^ 指数
	- % 余数

**bc预设近输出整数**如果想要输出小数点下位数，那么就必须要执行`scale=number`，那个number就是小数点位数。  

**quit** 退出  

--- 

从上面的练习，我们大概知道在指令列表模式里面下达指令时，会有两种主要的情况。  
- 一种是该指令会直接显示结果后回到命令提示符等待下一个指令的输入  
- 一种是进入到该指令的环境，知道结束该指令才回到命令指示符的环境。  


### 重要的几个热键[tab],[ctrl]-c,[ctrl]-d

- tab按键
	- 命令补全
	- 档案补全
	- 按下ca ——》 按两下 tab ：显示所有以ca开头的命令

- 【tab】接在一串指令的第一个字的后面，则为【命令补全】
- 【tab】接在遗传指令的第二个字以后时，则为【档案补全】
- 若安装 bash-completion软件，则在某些指令后面使用【tab】按键是，可以进行【选项/参数的补全】功能。  

**善用tab是一个很好的习惯，可以避免很多输入错误的机会**  

--- 

- 【ctrl-c】 按键
	- 终端目前程序（终止目前跑不停的程序）

---

- 【ctrl-d】
	- 键盘输入结束（End Of File，EOF 或 End Of Input）的意思，另外，他可以用来取代`exit`的输入呢。

如果你想要直接离开文字界面，可以直接按下ctrl-d就能够直接离开了（相当于输入exit啊）  

--- 

- 【shift】+【pageup | pagedown】按键
	- 如果你在输入某些指令后，显示的内容很长，但是没有办法看到前面的内容，可以用shift+pageup来往前翻页查看，

### 错误信息的查看

例如：

```
$ DATE
bash: DATE: command not found... 	#这里显示错误信息  
Similar command is: 'date'		#这里给出一个方案，可以试试诶。  
```

**通常出现 command not found 的原因有**：  

- 这个指令不存在，因为软件没有安装。解决方法就是安装软件  
- 这个指令所在的目录目前的用户并没有将它加入指令搜寻路径中，参考bash的PATH说明  
- 很简单，因为你打错字了。



## 3、linux系统的线上求助man page 与 info page

按一个字母g，再按两下tab系统会显示有200多个命令，问是否想要查看。  
所以说linux下的指令实在是太多了，根本就不需要背，背不过来的，所以就用到求助页面了。  

### 3.1 指令的 -help 求助说明

事实上，linux上面的指令，在开发的时候，开发者就将可以使用的指令语法与参数写为指令操作过程中了，你只需要使用 `--help` 这个选项，就能够将该指令的用法做一个大致的理解。  
例如： date --help  

同样的，bc --help的话，虽然有简单的解释，但是没有详细的用法说明，同时也不会有`+-*/`等运算符号（算子）的说明，因此，虽然 --help 已经相当好用，不过通常 --help 用在协助你查询 **你曾经勇敢的指令所具备的选项参数**而已，如果你要使用的是从来没有用过的指令，或者是你要查询的根本就不是指令，而是档案的 格式 时，那就得要通过 man page 了。  

### 3.2 man page 

**man 是 manual（操作说明）的简写**  
使用方法：man + 命令 例如：`man date`

在man page当中需要注意的重点：（以date指令为例）  

- 第一行命令名称后面的数字（例如：DATE(1)）
- NAME：这个指令的完整全名，下面会紧跟简单的用途。
- SYNOPSIS：这个指令的基本语法部分。
- DESCRIPTION：详细说明刚刚语法谈到的选项参数的用法。
- -d，--date ：左边-d为短选项名称，右边--date为完整选项名称
- ENVIRONMENT ： 与这个指令相关的环境参数有如下的说明
- EXAMPLES ： 一堆可用的范本
- DATE STRING ： 上面曾提到的 --date的格式说明。
- AUTHOR ： 这个指令的作者
- COPYRIGHT ： 收到著作权法的保护！用的就是GPL了！
- SEE ALSO ： 这个重要，你还可以从哪里查到与date相关的说明文件

#### 第一行指令后面跟的数字的含义

| 代号 | 代表内容 |
|:----:|:----:|
| 1 | 使用者在shell环境中可以操作的指令或可执行档 |
| 2 | 系统核心可呼叫的函数与工具等 |
| 3 | 一些常用的函数（function）与函数库（library）,大部分为C的函数库（libc） |
| 4 | 装置档案的说明，通常在/dev下的档案 |
| 5 | 设定档案或者是某些档案的格式 |
| 6 | 游戏（games） |
| 7 | 惯例与协定等，例如Linux档案系统、网络协定、ASCII code等等的说明 |
| 8 | 系统管理员可用的管理指令 |
| 9 | 跟kernel有关的文件 |

未来使用man page在查看某些资料时，就会知道该指令/档案所代表的基本意义是什么了。  
最低要求，1、5、8三个的含义背下来。  


#### man page 的几个部分 

| 代号 | 内容说明 |
|:----:|:----:|
| NAME | 简短的指令，资料名称说明 |
| SYNOPSIS | 简短的指令下达语法（syntax）简介 |
| DESCRIPTION | 较为完整的说明，这部分最好仔细看看。 |
| OPTIONS | 针对SYNOPSIS部分中，有列举的所有可用的选项说明 |
| COMMANDS | 当这个程序（软件）在执行的时候，可以在此程序（软件）中下达的指令 |
| FILES | 这个程序或资料所使用或参考或连接到的某些档案 |
| SEE ALSO | 可以参考的，跟这个指令或资料有相关的其他说明 |
| EXAMPLE | 一些可以参考的范例 |

有时候可能还会看到Authors与copyright等，不过也有很多时候仅有NAME和DESCRIPTION等部分。  
**鸟哥查询建议：**  

1. 先查看NAME的选项，简略看一下这个资料的意思；
2. 在详细看一下DESCRIPTION，这个部分会提到很多相关的资料与使用时机，从这个地方**可以学到许多小细节**呢。
3. 而如果这个指令其实很熟悉了（例如上面的date），那么查询的就会关于OPTIONS的部分了！可以知道每个选项的意义，这样就可以下达比较细节的指令内容了。
4. 最后，跟这个资料有关的还有哪些东西可以使用的？距离来说上面的SEE ALSO就告诉我们还可以利用`info coreuils date`来进一步查阅资料；
5. 某些说明内容还会列举有关的档案（FILES部分）来提供我们参考！这些都很有帮助的！

#### man page 的操作  

| 按键 | 进行工作 |
|:----:|:----:|
| 空白键 | 向下翻一页 |
| [Page Down] | 向下翻一页 |
| [Page Up] | 向上翻一页 |
| [Home] | 去到第一页 |
| [End] | 去到最后一页 |
| `/string` | 向下搜寻 string 这个字串 |
| `?string` | 向上搜寻 string 这个字串 |
| n,N | 利用/或?来搜寻字串时，可以用n来继续下一个搜寻(不论是/或?),可以利用N来进行反向搜寻 |
| q | 结束这次的 man page |

**注意：以上按键在 man page 的书面当中才能使用的！**  
既然有man page，自然就因为有一些文件资料，所以才能够以man page读出来！那么这些man page的资料放在哪里呢？  
不同的distribution通常可能有点差异，不过，通常是放在 `/usr/share/man`这个目录里头。  
然而我们可以透过修改它的man page搜寻路径来改善这个目录的问题，修改`/etc/man_db.conf(有的版本为man.conf或manpath.conf或man.config等)即可。  
至于更多man的讯息可以使用man man来查询，关于更详细的设定，会在bash说明。  

#### 搜寻特定指令/档案的man page说明文件

在某些情况下，你可能知道要使用某些特定的指令或修改某些特定的设定档，但是偏偏忘了该指令的完整名称。  
有写时候则是你只记得该指令的部分关键字。  
这个时候你要如何查出你所想要知道的man page呢？

1. 如何查出系统中还有那些跟 man 这个指令有关的说明文件呢？  

```
$ man -f man
man(1)      -an interface to the on-line reference manuals  
man(1p)     -display system documentation  
man(7)      -macros to format man pages  
```

使用`-f`这个选项就可以取得更多man相关的资讯，这里有man7和man1存在，当我么用 man man 的时候，到底是找的哪一个说明文档呢？  
其实，是可以指定不同的文件的，例如：  

```
$ man 1 man         -这里是用man(1)的文件资料  
$ man 7 man         -这里是用man(7)的文件资料
```

如果忘记下达数字，只有man man的时候，那么取出的资料到底是那个呢？这个就跟搜寻的顺序有关了。  
搜寻的顺序是记录在/etc/man_db.conf这个设定档案中，先搜寻到的那个说明文档，就会被显示出来！  
通常会先找到数字较小的那个，因为排序的关系。所以man man 会跟 man 1 man结果相同。  

除此之外，我们可以利用 **关键词** 找到更多的说明文档，从上面 man -f man 输出的结果中，我们知道其输出的资料是：  
- 左边部分：指令（或档案）一级该指令所代表的意义（就是那个数字）  
- 右边部分：这个指令简易说明。  

---

上面那个是有一点不同都不行，如果我们只有关键字的时候该怎么办呢？  

2. 找出系统的说明文档，只要有man这个关键字就将该说明列出来。  

```
$ man -k man
fallocate(2)    -manipulate file space
zshall(1)       -the Z shell meat-man page
...
```

以上就是，只要有 man 这个字眼的，都会找出来。  

---

事实上，还有两个指令与man page有关，这两个指令是man的简略学法：  

```
$ whatis [指令或资料]   -相当于 man -f [指令或资料]
$ apropos [指令或资料]  -相当于 man -k [指令或者是资料]
```

**注意** :这两个特殊指令要能使用，必须要有建立 whatis 资料库才行！这个资料库的建立需要以root的身份下达如下的指令：  

```
$ mandb
旧版linux这个指令是使用 mkdewhatis 
```

真心的没必要背指令。  

---

### info page

在所有的unix like系统当中，都可以利用man来查询指令或这是相关档案的用法；但是，在liux里面则又额外提供了一种线上求助的方法，那就是info这个好用的家伙啦！  
基本上，info和man的用途差不多，但是man page一口气输出一对资讯不同的是。  
**info page** 则是将文件资料拆成一个个的段落，每个段落用自己的页面来撰写，并且在哥哥页面中还有类似网页的超链接，来跳到不同的页面中，每个独立的页面也被称为一个节点（node）。  
可以将info page想成是文字模式的网页显示资料啦。  
不过你要查询的目标资料的说明文件必须要以info的格式来携程才能够使用info的特殊功能（例如超链接）  
这个支援info指令的文件预设是放在`/usr/share/info/`这个目录中。  

info页面的第一行中显示了喝多信息（以info info为例）  

```
File:代表这个info page的资料是来自info.info档案所提供的；
Node：代表目前的这个页面是属于Top节点。（意思是info.info内含有很多资讯，而top仅是档案内的一个节点内容而已；
Next：下一个节点的名称为Getting Started，你也可以按N到下个节点取；
Up：回到上一层的节点总览画面，你也可以按下U回到上一层；
Prev：前一个节点。但是由于Top是info.info的第一个节点，所以上面没有一个节点讯息。  

```

你可以通过直接按下 N P U 来去到下一个、上一个、上一层的节点(node)!  

无论在info的哪个界面，只要不知道怎么用了，按一下h就会有系统提供的基本按键功能介绍。  

看到 Menu ，我们可以使用上下左右按键来移动光标到*上面，按下Enter，就可以前往该小结。  
另外也可以按tab键，可以快速的将光标在画面上的node间移动。  

##### info 按键

| 按键 | 进行工作 |
|:----:|:----:|
| 空白键 | 向下一页 |
| [Page Down] | 向下一页 |
| [Page Up] | 向上一页 |
| [tab] | 在node间移动，有node的地方，通常会用*显示 |
| [Enter] | 当光标node上面时，按下Enter可以进入该node |
| b | 移动光标到该info画面当中的第一个node处 |
| e | 移动光标到该info画面当中的最后一个node处 |
| n | 前往下一个node处 |
| p | 前往上一个node处 |
| u | 向上移动一层 |
| s(/) | 在info page当中进行搜索 |
| h,? | 显示求助选项 |
| q | 结束这次的info page |

info page是只有Linux上面才有的产物，而且易读性增强很多，不过查询的指令说明要具有info page功能的化，得用info page的格式写成线上求助文件才行。  
CentOS 7将info page的文件放在了`/usr/share/info/`目录中。  
至于非info page格式写成的说明文件（就是man page），虽然可以用info来显示，但是结果会跟man相同。（例如：info man）  

### 其他有用的文件（documents）

一般而言，指令或软件的作者，都会将自己的指令或软件的说明制作成【线上说明文件】，但是，毕竟不是每个东西东需要写成线上说明文件的，还有相当多的说明需要额外的文件！此时，这个所谓的 How-To（如何做的意思）就很重要了。还有某些软件不仅告诉你如何做，还会说明一些相关的原理等等。  
那么这些文件在哪里呢？  

`/usr/share/doc`  

就在这个目录下了  

例如：你想知道 grub2 这个新版的开机管理软件有什么能使用的指令，找找看  
/usr/share/doc/grub2-tools-2.02  

另外，很多原版软件释出的时候，都会有一些安装须知、预计工作事项、未来工作规划等等东西，还有包括可安装的程序等，这些档案也都放在 `/usr/share/doc`当中。而且这个目录下的资料主要是以套件（packages）为主的，例如 nano 这个软件的相关资讯在 /usr/share/doc/nano-xxx(这个xxx表示版本的意思)  

---

总结上面三个东东（man、info、/usr/share/doc/），请记住喔：  

- 在终端模式中，如果你知道某个指令，但却忘记了相关选项与参数，请先善用 `--help` 的功能来查询相关资讯；
- 当有任何你不知道的指令或档案格式这种万一，但是你想要了解它，请赶块使用 man 或者 info 来查询！
- 而如果i想要架设一些其他的服务，或想要利用一整组软件来达成某项功能时，请赶快到 `/usr/share/doc` 底下查一查有没有该服务的说明文档喔！
- 另外，再次强调，因为Linux毕竟是外国人发明的，所以中文文件确实是比较少的！但是不要害怕，拿本英文字典在身边把！随时查询！不要害怕英文喔！


## 4、超简单文书编辑器：nano

小哥已经开始用vim了，这个谁愿意用自己学吧，我不学了。

## 5、真确的开关机方法：sync、shutdown、reboot、halt、poweroff、systemctl

当我们在使用DOS系统时，长城是直接关掉店员，而windows在你不爽的时候也可以按着电源4秒关机。但是在Linux则相当的不建议这么做！  

为什么不建议这么做呢？因为windows（非NT主机系统）系统中，是单人假多工的情况，所以你关机，不会对别人有影响！在Linux下是多人操作系统，因此，**在你看不到的屏幕背后其实可能有相当多人同时在你的主机上面工作**，这种时候若干是**不正常关机，则可能造成档案系统的毁损**（因为来不及将资料回写到档案中，所以有些服务的档案会有问题。）。  

所以正常情况下，要关机需要注意地下几件事情：  

- 观察系统的使用状态：  
	- 如果要看目前有谁在线上，可以下达`who`这个指令；
	- 如果要看网路的连线状态，可以下达`netstat -a`这个指令；
	- 如果要看后台之行的程序，可以下达`ps -aux`这个指令；
	- 使用这些指令可以让你稍微了解主机目前的使用状态！当然就可以判断是否可以关机（这些指令在后面Linux常用指令中会提到。）

- 通知线上使用者关机的时刻：  
	- 要关机前总得给线上的使用者一些时间来结束他们的工作，所以，这个时候就可以使用`shutdown`的特别指令来达到此一功能。  

- 正确的关机指令使用：  
	- 例如 shutdown 与 reboot 两个指令！  

---

所以地下我们学下几个与关机/重启相关的指令！  

- 将资料同步写入硬盘中的指令： sync  
- 惯用的关机指令： shutdown  
- 重新开机·关机： reboot、halt、poweroff  

Tips：因为系统的关机/重启是很重大的系统运作，因此只有root才能运行例如shutdown、reboot等指令。不过在某些distributions当中，例如centos中，允许一般账号来关机/重启！某些distributions则在你要关机/重启时，它要你输入root密码。

---

#### 资料同步写入磁盘：sync

linux为了加快资料的读取速度，所以在预设的情况下，某些已经载入载入内存的资料不会直接写入硬盘，而是先暂存起来，如此一来，一个资料被重复改写，那么因为尚未写入磁盘，那么读取速度会很快，但是如果断电或关机的话可能造成数据丢失。  
这个时候就需要sync这个指令了，直接输入sync，那么没被写入硬盘的资料会被写入硬盘中。  
**这个指令在系统关机或重启之前，最好多执行几次，非常重要。**

虽然目前的shutown/reboot/halt等指令都已经在关机前进行了sync的呼叫，不过，多做几次总是比较放心点的。  

```
$ su - 	#切换root用户 
Password:
Last login: ......

# sync
```

Tips:事实上 sync 也可以被一般账号使用，只不过一般账号使用者所更新的硬盘资料就只有自己的资料，不像root可以更新整个系统中的资料了。  


#### 惯用的关机指令：shutdown

由于Linux的关机是非常重要的工作，因此除了你是在主机前面的实体终端（tty1-tty7）来登入，不论什么身份都可以执行。  
如果是使用远程控制，那么关机就只有root有权限而已了。  

---

我们常用的是shutdown这个指令，而这个指令会通知系统的各个程序（processes），并通知系统中的一些服务来关闭。shutdown可以达成如下的工作：  

- 可以自由选择关机模式：是要关机或重新开机均可；
- 可以设定关机时间：可以核定成现在立刻关机，也可以设定某一个特定的时间才关机。
- 可以自定义关机讯息：在关机之前，可以将自己设定的讯息传送给线上user。
- 可以仅发出警告讯息：有时有可能你要进行一些测试，而不想让其他的使用者干扰，或者是明白的告诉使用者某段时间要注意一下！这个时候可以使用shutdown来吓一吓使用者，但却不是真的要关机！  

**可以自己man一下啦**

```
# /sbin/shutdown [-krhc] [时间] [警告讯息]  
选项与参数：
-k 	：不要真的关机，知识发送警告讯息出去！
-r	：在将系统的服务停掉之后就重新开机（常用）
-h	：将系统的服务停掉后，立即关机（常用）
时间	：指定系统关机的时间！时间的范例地下会说明。若没有这个选项，则预设1分钟后自动进行。

范例：
# /sbin/hutdown -h 10 'I will shutdown after 10 mins'
Broadcast mesage from root@study.centos.vbird (Tue 2015-06-02 10:51:34 CST):

I will shutdown after 10 mins
The system is going down for power-off at Tue 2015-06-02 11:01:34 CTS!
```

在执行shutdown之后，系统告诉大家，机器会在十分钟后关机，并会将讯息显示在目前登入者的屏幕前！  
你可以输入`shutdown -c`来取消这次的关机指令。  
而如果什么参数都没有加，淡村执行shutdown只有，系统预设会在1分钟后进行 关机 动作。  

Tips：旧版shutdown后一定要时间参数才行，如果没有，系统会跳到单人维护模式，新版中会议1分钟为限，进行自动关机任务，所以时间参数可以不用加了。  

---

**常见时间参数范例**

```
# shutdown -h now
立刻关机，其中 now 相当于时间为 0 的状态

# shutdown -h 20:25
系统在今天 20：25 分关机，如果在 21：25 才下达此指令，则隔天才关机

# shutdown -h +10
系统再过十分钟后自动关机

# shutdown -r now
系统立刻重新开机

# shutdown -r +30 'The system will reboot'
再过30分钟系统会重启，并显示后面的讯息给所有线上使用者

# shutdown -k now 'This system will reboot'
仅发出警告信件的参数！系统并不会关机！吓唬人的！
```






## 6、重点回顾

