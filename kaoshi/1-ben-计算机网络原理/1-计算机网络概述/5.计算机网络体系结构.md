# 第一章 计算机网络体系概述 第五节 计算机网络体系结构

## 一、计算机网络分层体系结构

从计算机网络硬件设备角度来看，有了主机、链路和交换设备就能够使两个用户在硬件上建立连接，并实现数据交换。但是要顺利地进行信息交换，或者说让计算机网络正常运转，通信双方还必须遵守相同的协议。  

计算机网络作为综合计算机技术与通信技术的复杂系统，显然不可能由一个或少数几个协议就能约定网络通信过程中索要遵守的所有规则，实现所有工能。  
因此，在指定网络协议时经常采用的思路是将复杂的网络通信功能划分为由若干协议分别完成，然后将这些协议按照一定的方式组织起来，最终实现网络通信的所有功能。  
最典型的划分方式就是采用分层的方式来组织协议。  
分层的核心思路是上一层的功能建立在下一层的功能基础上，并且在每一层内均要遵守一定的通信规则，即协议。  

按照分层的思想，计算机网络完成的所有功能可以划分为若干层，每层完成一部分子功能。每层在完成相应功能时与另一通信实体的相同层按照某种协议进行信息交换。  
**这样，计算机网络所划分的层次以及各层协议的集合称为计算机网络体系结构。**  
体系结构应当具有足够的信息，以便软件设计人员为每层编写实现该层协议的有关程序，即协议软件。  
需要注意的是，这种分层体系结构通常是按功能划分的，并不是按实现方式划分的。  

*早期许多见算计制造商开发了自己的计算机网络系统，例如：IBM公司从20实际 60年代后期开始开发了系统网络体系结构（systems Network Architecture， SNA），并从 1974年先不了 SNA 机器产品；数字设备公司（DEC）也发展了自己的网络体系结构（digital Network Architecture，DNA）。*  
各种网络体系结构的发展增强了系统成员之间的通信能力，但同时也产生了不同厂家之间的通信障碍，因此迫切需要制定全球统一的网络体系结构标准。  
目前，典型的层次体系结构有OSI参考模型和 TCP/IP 参考模型两种。  

--------

## 二、OSI参考模型

负责定制国际标准的国际标准化组织 ISO 参考了 IBM 的 SNA 和其他计算机厂商的网络体系结构，提出了开放系统互联（open system Interconnection）参考模型，简称 OSI 参考模型，按照这个标准设计建成的计算机网络中的设备都可以互相通信。  

### 1、OSI 参考模型

OSI 参考模型采用分层结构化技术，将整个计算机网络的通信功能分为7层，由底层至高层分别是：**物理层、数据链路层、网络层、传输层、会话层、表示层、应用层**。每一层都有特定的功能，并且上一层利用下一层的功能所提供的服务，完成本层功能。  

在 OSI 参考模型中，各层的数据并不是从一端的第 N 层直接松到另一端的对等层，第 N 层接收 N+1 层的协议数据单元（PDU），按第 N 层的协议进行封装，构成第 N 层 PDU，再通过层间传递给第 N-1 层，以此类推，最后。数据链路层 PDU （通常称为数据帧）传递给最底层的物理层。  

数据在垂直的层次中自上而下的逐层传递直至物理层，在物理层的两个点点进行物理通信，这种通信称为**实通信**,由于对等层通信并不是直接进行，因而称为**虚拟通信**.  

**中间系统（比如路由器）通常只是实现物理层、数据链路层和网络层功能**  
因此，SOI参考模型的 物理层、数据链路层和网络层称为**节点到节点层**,传输层、会话层、表示层和应用层称为**端到端层**。  

#### (1)、物理层

**物理层主要功能是** : 在传输介质上实现无结构比特流传输。*所谓无结构比特流是指：不关心比特流实际代表的信息内容，只关心如何将 0 和 1 这些比特以合适的信号传送到目的地，因此，物理层要实现信号编码功能。*  

**物理层的另一项主要任务** : 就是规定数据终端设备（DTE）与数据通信设备（DCE）之间接口的相对特性，主要包括机械、电气、功能和规程 4 个方面的特性。  

1. 机械特性 ： 也叫物理特性，说明硬件连接接口的机械特点，如接口的形状、尺寸、插脚的数量和排列方式等。  
2. 电气特性 ： 规定了在物理连接上，导线的电气连接一级有关电路的特性，如信号的电平大小、接收器和发送器电路特性的说明、信号的识别、最大传输速率的说明等。  
3. 功能特性 ： 说明物理接口各条信号线的用途，如接口信号线的功能分类等。  
4. 规程特性 ： 指明利用接口传输比特流的全过程及各项用于传输的时间发生的合法顺序，包括时间的执行顺序和数据传输方式，即在物理连接建立、维持和交换信息时，手法双方在各自电路上的动作序列。  

这些功能都是由物理层的协议来完成的。典型的物理层协议包括 RS-232c、RS-449 以及其他网络通信标准中有关物理层的协议等。  

#### (2)、数据链路层

**数据链路层的主要功能** : 是实现在相邻结点之间数据可靠而有效的传输。  

数据在物理介质内传输过程，不能保证没有任何错误发生。为了实现有效的差错控制，就采用了一种以“帧”为单位的数据块传输方式。  
要采用帧格式传输，就必须有相应的帧同步技术，这就是数据链路层的“成帧”（也称为“帧同步”）的功能，包括定义帧的格式、类型、成帧的方法等。  

有了“帧”的存在，就可以将差错控制技术应用在数据帧中，例如：将数据码后面附加一定位数的循环码，从而实现数据链路层的差错控制功能。  
数据链路层还可以实现相邻结点间通信的流量控制。  
某些数据通信网络的数据链路层还提供连接管理功能，即通信前建立数据链路，通信结束后释放数据链路，这种数据链路的建立、维持和释放过程称为**链路管理。**  

**数据链路层的另一个重要功能功能是寻址** : 即用来确保每一帧都能准确的传送到正确的接收方，接收方也应该知道发送方的地址，这在使用广播介质的网络中尤为重要，比如计算机局域网中广泛采用 MAC 地址。  
*第五章介绍的多路访问技术也是数据链路层实现的功能功能，例如，采用广播信道的数据通信网络 ALOHA 协议、CSMA/CD 等。*  

#### (3)、网络层

**网络层解决的核心问题是如何分组通过交换网络传送至目的主机**, 因此，网络层的主要功能功能室数据转发与路由。  

在交换网络中，信息从源节点出发，要经过若干个中继结点的存储转发后，才能到达目的结点。这样一个包括源节点、中继结点、目的结点的集合称为**从源节点到目的结点的路径**。  
一般在两个结点之间都会有多条路径选择，这种路由选择是网络层要完成的主要功能之一。  

当网络设备，比如路由器，从一个接口收到数据分组时，需要根据已掌握的路由信息将其转发到合适的接口并向下一个结点发送，直至送达目的结点。此外，网络层还要对进入交换网络的通信量加以控制，以避免通信量过大造成交换网络性能下降。  

当然，和数据链路层类似，网络层也要具备寻址功能，确保分组可以被正确传送到目的主机，比如 Internet 网络中的 IP 地址。  

#### (4)、传输层

**传输层是一个端到端的层次，也是进程到进程的层次**。  
数据的通信表面上看是在两台主机之间进行，但实质上是发生在两个主机的进程之间。  

OSI参考模型的前三层（自下而上）可组成公共网络，被很多设备共享，并且计算机--交换结点（典型的交换结点是路由器、交换机等）、交换结点--交换结点是按照“接力”方式传送的。  
为了放置传送途中报文的丢失，两个主机的进程之间需要实现端到端控制。  
因此，传输层的功能主要包括复用/分解（区分发送和接收主机上的进程）、端到端的可靠数据传输、连接控制、流量控制和拥塞控制机制等。  

#### (5)、会话层

**会话层** : 指用户与用户的连接，通过在两台计算机间建立、管理和终止通信来完成对话。  

会话层的主要功能：  

1. 在建立会话时核实双方身份是否有权参加会话  
2. 确定双方支付通信费用  
3. 双方在各种选择功能方面（如全双工还是半双工通信）取得一致  
4. 在会话建立以后，需要对进程间的对话进行管理与控制，例如，对话过程中某个环节出了故障，会话层在可能条件下必须保存这个对话的数据，使数据不丢失，如不能保留，那么终止这个对话，并重新开始。  

在实际网络中，会话层的功能已经被应用层所覆盖, **很少单独存在**。  

#### (6)、表示层

**表示层** : 主要用于处理应用实体交换数据语法，其目的是解决格式和数据表示的差别，从而为应用层提供一个一致的数据格式，使字符、格式等有差异的设备之间相互通信。  

除此之外，表示层还可以实现文本压缩/解压缩、数据加密/解密、字符编码的转换等功能。  

这一层的功能在某些实际数据通信网络中是由应用层来实现的，而且**表示层不独立存在**。  

#### (7)、应用层

**应用层** : 为用户提供了一个使用网络应用的“接口”。  
应用层提供给用户的网络服务相关，这些服务非常丰富，包括文件传送、电子邮件、P2P应用等。  

```
SOI 参考模型的 7 层中：  
1-3 层主要是完成数据交换和数据传输，称之为网络低层；  
5-7 层主要是完成信息处理服务的功能，称之为网络高层；  
低层与高层之间由第 4 层衔接。  
```

### 2、OSI 参考模型有关术语

OSI 参考模型中每一层的真正功能是为其上一层提供服务。  

#### (1)、数据单元

在层的实体之间传送的比特组称为数据单元。  

在对等层之间除宋数据单元是按照基本协议进行的，因此，这时的数据单元成为**协议数据单元（PDU）**。  

**此处需要看图片**  

图片中，  
- PDU是协议数据单元  
- SDU是服务数据单元  
- PCI是协议控制信息，通常作为PDU的不收。  

(N+1)-PDU 在越过 N+1 和 N 层的边界之后，变换为 N-SDU (N 层把(N+1)-PDU 看成 N-SDU）。  
N 层在 N-SDU 上加上 N-PCI ，则称为 N-PDU。  

在 N-PDU 和 (N+1)-PDU 之间并非是一一对应的关系。如果 N 层认为有必要，可以把(N+1)-PDU 拆成几个单位，在加上 PCI 后称为多个 N-PDU，或者可以把多个(N+1)-PDU 合起来，形成一个 N-PDU。  


到达目的站的 N-PDU ，在送往 (N+1) 层之前要把 N-PCI 去掉。在层间通讯中 PCI 相当于报头，即**部首**.  

在源点逐层增加新的 PCI ，到达目的地之后则逐层去掉，使得信息来源的结构得以恢复。  

值得指出的是，PDU 在不同层往往有不同的叫法，如：  

- 在物理层称为位流或比特流  
- 在数据链路层称为帧  
- 在网络层中称为分组或包  
- 在传输层中称为数据段或报文  
- 在应用层中称为报文等  

#### (2)、服务访问点

相邻层间的服务是通过其接口面上的服务访问点（service Access Point, SAP）进行的， N 层 SAP 就是(N + 1) 层可以访问 N 层的地方。  
每个 SAP 都有一个唯一的地址号码。  

#### (3)、服务原语

第 N 层向 (N+1) 层提供服务，或第（N+1）层请求 N 层提供服务，都是用一组原语（Primitive）描述的。  

OSI 参考模型的原语有 4 类，分别如下：  

- 请求（Request）：用户实体请求服务做某种工作。  
- 指示（Indication）：用户实体被告知某件事发生。  
- 响应（Response）：用户实体表示对某件事的相应。  
- 证实（Confirm）：用户实体收到关于它的请求的答复。  

这 4 类余元，在通信过程的三个阶段中，每个阶段都可能用到一些或全部原语。  

例如：系统A中N+1层用户和系统B中N+1层用户之间建立通信联系时 4 种类型原语的应用。  
首先，系统 A 中 N+1 用户发出请求原语，调用本地系统 N 服务提供者的一些程序，于是 N 服务提供者向对方发送一个或一组 N-PDU。  
当系统 B 的 N 服务提供者收到 N-PDU 之后，向本系统的 N+1 用户发出指示原语，说明 B 的 N+1 用户需要调用一些程序，或者 N 服务提供者已经在同级服务访问点调用了一个程序。  
响应原语是由系统 B 的 N+1 用户发出的，这个相应原语是对 N 层协议的一个指令，以完成原来由指示原语调用的程序。N层协议产生一个 PDU，传送至系统 A 的 N 层。  
系统 A 的 N 服务提供者发出证实原语，表示在服务访问点已经完成了由请求原语调用的程序。证实和相应可以是确认也可以是否认，这取决于具体情况。  

#### (4)、面向连接的服务和无连接的服务

在分层的体系结构中，下层向上层提供服务通常有两种形式：面向连接的服务和无连接的服务。  

- 面向连接的服务：以电话系统最为典型，要和某人通话，拿起电话--拨号码--接通--通话--挂断。  
    - 某一方欲传送数据，首先给出对方的全称地址，并请求建立连接，当双方同意后，双方之间的通信链路就建立起来。  
    - 第二步是传送数据，通常以分组为单位，按序传送，不在标称地址，指标称所建立的链路好，并由收方对收到的分组予以确认，称为可靠传送方式；不确认则称为不可靠传送方式。  
    - 第三步当数据传送结束后，拆除链路。  

- 无连接的服务：没有建立和拆除链路的过程，例如：邮政系统的用户在发送信件之前并不必与收信方进行任何消息交换。
    - 无连接的服务又称为数据报（Datagram）服务，要求每一个分组信息带有全称地址，独立选择路径，其到达目的地的顺序也是不定的，到达目的地址后还要诚信对分组进行排序。  

--------

## 三、TCP/IP 参考模型

实际应用的网络中几乎没有严格按照 OSI 参考模型构建的。 OSI 参考模型的重要意义在于它是一种计算机网络的理论体系结构，是目前学习、讨论计算机网络的一种工具，能够从理论上恨到的解释网络概念，层次与通信过程，是学习计算机网络必须学习和账务的内容。  
作为最大、最重要的计算机网络——因特网的体系结构则可以用 TCP/IP 参考模型进行描述。  

### 1、TCP/IP 参考模型

TCP/IP 参考模型包括 4 层，通常每一层封装的数据包采用不同的名称：  

```
# 以下的第二个小写字母均为下角标；  

报文                M   应用层  
段              Ht  M   传输层  
数据报      Hn  Ht  M   网络互联层  
帧      Hi  Hn  Ht  M   网络接口层  
```

下面为TCP/IP参考模型各层的主要功能及主要协议。  

#### (1)、应用层

TCP/IP 参考模型将 OSI 参考模型中会话层和表示层的功能合并到了应用层来实现，在 internet 上常见的一些网络应用大多在这一层，用户通过应用层来使用 Internet 提供的各种服务，例如：WWW 服务、文件传输服务、电子邮件等。  
每一种应用都使用了相应的协议来将用户的数据（网页、文件、电子邮件等）按照协议定义的格式进行封装，以便达到对应的控制功能，然后在利用下一层即传输层的协议进行传输，例如：www 服务的应用层协议为HTTP、文件传输的应用层协议为 FTP、电子邮件应用层协议包括 SMTP 和POP3 等。  
每一个应用层协议一般都会使用到两个传输层协议之一进行数据传输；面向连接的传输控制协议 TCP 和 无连接用户数据报协议 UDP。  

#### (2)、传输层

当应用层的程序将用户数据按照特定应用层协议封装好后，接下来就是传输层的协议负责把这些数据传输到接收方主机上对等的应用层程序。  
传输层协议为运行在不同主机上的进程提供了一种**逻辑通信机制**, 之所以叫逻辑通信，是因为两个进程之间的通信就像所在的两个主机存在直接连接一样。  
其实，两个主机可能相距很远，两者的物理连接可能经过了多个交换机/路由器，传输路径可能由不同类型的物理链路组成。利用这种逻辑通信机制，两个进程可以不用考虑两者之间的物理连接方式而实现发送/接收消息。  

**传输层协议可以解决** : (如果需要）诸如端到端可靠性，保证数据按照正确的顺序到达等问题。  

实际上，传输层负责在网络层和应用层之间传递消息，丝毫不会涉及消息如何在网络中传输，这个任务交给下面的网络互联层取解决。  
TCP/IP 参考模型的传输层主要包括面向连接、提供可靠数据流传输的传输控制协议 TCP 和无线连接不提供可靠数据传输的用户数据报协议 UDP。  

#### (3)、网络互联层

网络互联层是整个 TCP/IP 参考模型的核心，**主要解决** 把数据分组发往目的网络或主机的问题。  

这个过程中，要为分组的传输选择相应的路径（路由选择），完成分组的转发，提供网络层寻址——IP地址。  
网络互联层除了需要完成路由的功能外，也可以完成将不同类型的网络（异构网）互连的任务。在 TCP/IP 参考模型中，网络互联层的**核心协议是IP** , 负责定义分组的格式和传输。  
IP 是无连接不可靠网络协议，因此，IP 分组到达的顺序和发送的顺序可能不同，并且可能存在分组丢失现象。网络互联层还包括互联网控制报文协议 ICMP、互联网多播组管理协议 IGMP 以及路由协议，如 BGP、OSPF 和 RIP 等。  

#### (4)、网络接口层

实际上、 TCP/IP 参考模型没有真正描述这一层的实现，只是要求能够提供给其上层——网络互联层一个访问接口，以便在其上传递 IP 分组。由于这一层未被定义，所以其具体的实现方法将随着网络类型的不同而不同。  
实际上，这一层对应 OSI 参考模型中的数据连路层和物理层，网络 IP 分组在这一层被封装到底层网络的链路层数据帧中，并最终以比特流的形式在物理介质上进行传输。  

--------

## 四、五层参考模型

对比 TCP/IP 参考模型与 OSI 参考模型， TCP/IP 参考模型缺少 OSI 参考模型中功能比较少的表示层与会话层。  
而 TCP/IP 参考模型网络接口层则相当于合并了 OSI 参考模型的数据链路层与物理层。  

结合这两个参考模型，可以提出综合理论需求与实际网络的五层参考模型，包括物理层、数据链路层、网络层、传输层与应用层，各层功能基本与 OSI 参考模型对应。这是近年来，在描述计算机网络中最常用、最接近实际网络的参考模型。  

基于五层参考模型来描述网络通信的过程。  

用户的数据在应用层以报文的形式开始向下一层进行封装，形成段、数据报、帧，最后以比特流的形式进行传输。在中间节点处，例如路由器、交换机，分别从对应的数据报、帧中取出相应的路由或地址信息并进行处理，并依据转发策略向正确的接口转发数据报或帧。  
当数据到达目的主机后，自下而上，逐层处理并去掉相应的头部信息，最终还原为最初的报文，交付给用户。  








