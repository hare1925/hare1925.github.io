# 第一章 第三节 数据交换技术

## 一、数据交换的概念

计算机网络的根本目的是在网络边缘的主机之间实现相互的数据传输、信息交换。  

一个主机为了同时与其他主机通信，可以选择通过通信链路直接连接所有主机。构成完全网状网络。  
在这种网络中，如果主机数为N，则每个主机需要同时建立（N-1）条链路，整个网络共需要 N(N-1)/2 条链路。  
显然，当N较大时，网络需要的链路数量很大，每个主机需要维护的链路数量也很大。  
这不仅会带来网络建设成本问题，也会带来许多技术问题，例如，主机如何同维护众多通信链路一级如何灵活扩展网络。  
因此，往网络规模较大（即N较大）时，通过通信链路直接连接所有通信终端是不可行的。于是，人们发明了**交换设备**。  

**交换设备** 具有多通信端口，可以同时连接多个通信结点（即主机或交换设备），实现通信端口间物理或逻辑上的动态、并行通信。  
通过交换设备，每个主机只需一个通信链路与交换设备相连，即可实现与其他主机的通信。  

一个交换设备的端口数量是有限的，并且也无法通过一条通信链路直接连接距离遥远的主机或通信设备，因此，只有在特殊情况下，如小规模局域网，才有可能利用一个交换设备直接连接所有主机。  
为了连接更大范围、更多数量的主机，可以将许多交换设备互连，构成一个数据中继与转发的“中间网络”实现中继与转发。  

这个中间网络不需要关心所传输数据的内容，而只是为这些数据从一个结点到另一个结点直到到达目的结点提供数据中继与交换的功能，因此，称之为数据交换网络，组成交换网络的结点（即交换设备）称为**交换结点**。  

**交换结点和传输介质的合集称为通信子网，即网络核心。**  

数据交换是实现在大规模网络核心上进行数据传输的技术基础。常见的数据交换技术包括电路交换(circuit switching)、报文交换(message switching)和分组交换(packet switching)。  

基于不同交换技术构建的网络分别称之为：电路交换网络、报文交换网络和分组交换网络。  

--------

## 二、电路交换

电路交换是最早出现的一种交换方式，距今已有 100 多年的历史，而电话网络则是最早、最大的电路交换网络。  

在电路交换网络中，首先需要通过中间交换结点为两台主机之间建立一条专用的通信线路，称为**电路**，然后再利用该电路进行通信，通信结束后再拆除电路。  
电话网络的电话拨号呼叫过程就是请求建立电路的过程。电路交换网络在建立电路时，为整个回话在眼线所有链路上都预留一个专用信道，传输速率恒定。  
这个通信过程中，交换设备对通信双方的通信内容不做任何干预，即对数据的编码、符号、格式和传输控制顺序等没有影响。  

**利用电路交换进行通信包括：建立电路、传输数据和拆除电路 3 个阶段。**  

### 1、建立电路

传输数据之前，必须建立一条端对端的电路，这个电路建立过程实际上就是一个个交换结点的接续过程。  
需要指出的是，这个电路可能不是通信双方之间直接的连接，而是通过若干个中间交换结点实现的连接。如果两个主机之间需要进行通信，那么发送主机需要先发出呼叫请求信号给接受主机，然后经过若干结点沿途接通一条物理链路后，在由接受主机发出应答信号给发送主机，这样双方之间的电路连接就建立成功了。  
只有电路建立成功之后，才能进入数据传输阶段。  
其中，电路交换的这种“接续”过程所需时间（电路建立时间）的长短与接续的中间交换结点的个数有关。  

电路建立之后在两个主机之间的每一段物理链路上都为双方的通信预留了相应的带宽，这个带宽在双方通信期间将一直保留并独占。  
为了充分利用物理链路的带宽，通常会采用相关的信道复用技术，如频分多路复用、分时多路复用等，将交换节点之间的线路进行信道共享，也就是说在交换结点之间通常包含有“n”条电路，这些电路彼此之间是独立的，每条电路专门为某一对特定主机间的通信服务，而主机到交换结点之间的链路则通常为独占的。  

### 2、传输数据

在电路建立之后，主机之间就可以进行数据传输了。被传输的数据可以是数字数据也可以是模拟数据，数据的传输可以是单工也可以是全双工。  

在发送主机和接收主机之间存在一条“独占”的物理线路为双方的宾词通信服务，这里的“独占”指的是交换节点之间的线路是相对独占的，因为通过信道复用技术对一条物理信道进行信道划分；而主机的交换结点之间的线路往往是绝对独占的。例如，打电话时通话双方均为“占线”状态，而此时可能会有多路通话在交换网络中同时进行。  
在本次通信结束之前，这条“独占”的物理线路上的所有资源不能被其他主机使用，即使某一时刻通信双方并没有数据进行传输。  


### 3、拆除电路

数据传输结束后，要释放（拆除）该物理链路。  
该释放动作可由两个通信主机之间任何一方发起并完成。  
释放信号必须传送到电路所经过的各个结点，以便重新分配资源。  
电路交换方式在传输数据之前需要建立电路，电路建立时间存在延迟。电路建立后即为专用电路，即使没有数据传输也要占用资源，从而造成线路的利用率低。  
在传送数据期间，网络通常不对用户信息进行误码校正等处理，没有任何差错控制措施，不利于可靠性要求高的数据业务。  
但是一旦电路建立，用户就可以使用固定的速率传输数据，传输实时性好。  
中间结点也不对数据进行其他缓冲和处理，不需要添加额外控制信息，即为”透明“传输，因此交换效率高。  

综上所述：电路交换的特点是有连接的，在通信时需要先建立电路连接，在通信过程中独占一个信道，通信结束后拆除电路连接。  
电路交换的优点是：实时性高，时延和时延抖动都较小。  
缺点是：对于突发性数据传输，信道利用率低，且传输速率单一。  

电路交换主要适用于语音和视频这类实时性强的业务。  

--------

## 三、报文交换

当主机交换的数据具有随机性和突发性时，采用电路交换方法的缺点是信道容量和有效时间的浪费，于是提出了报文交换的方法。  
**报文交换也称为消息交换**  
其工作过程为：发送方把要发送的信息附加上发送/接收主机的地址及其他控制信息，构成一个完整的报文（Message）。然后以报文为单位在交换网络的各个结点之间以存储-转发的方式传送，直至送达目的主机。  

一个报文在每个结点的延时时间，等于接收报文所需的时间加上向下一个结点转发所需的排队延迟时间之和。  
可以看出，报文交换事先不需要建立连接，发送方组装好报文之后即可向相邻的交换结点发出，交换结点收到整个报文并检查无误后，暂时存储报文，然后利用路由器选择找出需要转发的下一个结点的地址，再把整个报文转发给下一个结点。  
交换结点的这种接受-暂存-转发的工作方式，就称为“存储-转发”交换方式。  

优点： 只有当报文被转发时才占用相应的信道，不存在电路交换中通信双方空闲时信道也要被占用的情况。因此，相对电路交换信道而言，报文家欢线路利用率高。  

缺点： 报文交换网络中交换结点需要缓冲存储，报文需要排队，因此会导致报文经过网络的延迟时间边长并且不固定，对于实时通信而言会容易出现不能满足速度要求的情况。有时候结点收到的报文过多而存储空间不够后者输出链路被占用不能及时转发时，就不得不丢弃报文，这也就是报文交换的缺点。  

在报文交换链路上，报文在整个传输过程中，每个报文在穿越网络时都不被分割。此时，交换机是 存储-转发 报文交换机，他们必须接收到一个完整的报文，然后才可能开始把报文转发到某个输出链路上。  

20世纪40年代的电报通信中，采用的就是基于 存储-转发 原理的报文交换，在报文交换中心，一份份电报被接受下来，并穿成纸带。操作员以没分报文为单位，撕下纸带，根据报文的目的站地址，拿到相应的发报机转发出去。这种报文交换的时延较长，从几分钟到几个小时不等。现在计算机网络没有采用报文交换技术的。  

--------

## 四、分组交换

### 1、分组交换基本原理

分组交换是目前计算机网络广泛采用的技术。  

分组交换需要将待传输数据（即报文）分割成较小的数据块，每个数据块附加上地址、序号等控制信息构成数据分组（packet），每个分组独立传输到目的地，目的地将收到的分组重新组装，还原报文。分组传输过程通常采用 存储-转发 交换方式。  

1961 年，麻省理工学院（MIT）的一名研究生 Leonard Kleinrock，首次提出分组交换技术，并利用排队论证明了分组家欢处理突发流量的网络传输的有效性。  

1964 年，兰德公司的巴兰（Paul Baran）开始研究应用分组家欢技术，实现在拒用网络上进行安全语音传输，得出的解决方法就是在计算机网络通信中把要发送的信息分隔为“信息块”，每个信息块分别传输。  

与此同时，应该国家物理时延时（National Physical Laboratory，NPL）的戴维斯（Donald Davies）也在自己独立的研究中得出类似结论。  

巴兰提出的“信息块”概念在戴维斯的研究中被称为分组，相应的这种通信技术别成为分组交换，目前世界上广泛使用的分组家欢概念即由此而来。  


分组交换是报文交换的一种改进，它将一个完整报文拆分成若干个分组，每个分组的长度有一个上限，有限长度的分组使得每个结点所需要的存储能力降低，分组可以存储到内存中，提高了交换速度。  
分组交换是计算机网络受用最广泛的一种数据交换技术，现代计算机网络几乎都是分组交换网络。（因此，在下文中不加以特别说明的前提下，默认提到的计算机网络都是分组交换网络。）  

--------

### 2、分组交换的优点

分组交换与报文交换相比，两者都采用存储-转发交换方式，最主要的区别在于是否将报文拆分为更小的分组。  
分组交换在拆分与组装分组过程中，一方面会消耗一定的计算资源，另一方面还需要发夹更多的控制信息，会在一定成都上降低有效数据传输效率。  
因此，表面上看，似乎报文交换更优于分组交换。但实质上，这个表面上的微笑变化却大大的盖上了交换网络的性能。与报文交换相比，分组交换主要有如下优点。  

#### 1、交换设备存储容量要求低

作为存储-转发交换方式，报文交换需要缓存整个报文，当报文很大是，要求报文交换设备具有很大的存储容量；分组交换将大报文拆分为较短的分组进行传输。理论上讲，分组家欢设备只要能缓存一个小组，网络就可以工作。因此，分组交换可以大大降低对网络交换结点的存储容量要求。  

#### 2、交换速度快

报文交换在缓存大报文时，有可能需要将报文存储到速度较慢的外存储设备上，使得报文交换设备完成报文转发需要较长时间；分组交换设备由于只需要缓存一定数量的较短的分组，因此可以利用主存储器进行存储-转发处理，不需访问外存，处理转发速度加快。另外，在分组交换网络中，多个分组可以在网络中的不同链路上进行并发传送，大大提高传输效率和线路利用率，大幅缩短整个报文通过网络的时间。  

#### 3、可靠传输效率高

网络通信通常需要确保可靠、无差错地实现数据从源主机向目的主机的传输。实际通信链路不可能实现 100% 无差错，对于传输过程出错的数据，纠正错误的最常见措施是请求发送方重新发送出错的数据，知道接受端接收到正确的数据为止。  

对于报文交换网络，一个报文出现差错（哪怕是1位出错），需要重新传输整个报文；对于分组交换网络，一个分组出现差错，只需要重传出错的分组，并不需要重传所有由统一报文拆分出来的分组。报文长度通常远远大于分组长度，在差错概率相同的条件下，报文交换网络中的一个报文出现差错的概率，大于分组价换网络中一个分组出现差错的概率，而重传一个报文的代价要远远大于重传一个分组的代价。因此，在存在差错可能的情况下，分组交换实现可靠性传输的效率要高于报文交换。  

#### 4、更加公平

报文交换网络中，数据是以报文为单位进行存储-转发的，如果两个大小差异很大的报文沿相同路径向相同目的传输，且大报文在缓存队列中排在前面，小报文排在后面，按照最常见的转发调度规则，即先到先服务，大报文在每个交换结点上总是在小报文之前转发，小报文只有等待大报文转发结束后才能转发。  
在这种场景下，小报文将经历更长的时间通过网络送达目的地。显然报文交换不能确保小报文用更短的时间通过网络，是不公平的。  
同样的场景，对于分组交换，如果分组大小相同，那么大报文将拆分出更多的分组，小报文将拆分出较少的分组，不同报文的分组在交换结点上可能交替排队，每个分组通过网络的时间相当，总体上，小报文将用较短时间通过网络到达目的地。  
因此，分组交换更加公平。  

--------

### 3、分组长度的确定

分组交换方式中分组长度的选择非常重要。  
它与交换过程中的延迟时间、交换设备存储容量、线路利用率、信道传输质量、数据业务统计特性一级交换机费用等诸多因素有关，比较复杂。下面讨论分组长度与延迟时间、误码率的关系。  

#### 1、分组长度与延迟时间

分组长度与交换过程的延迟时间关系可以利用排队论进行分析。分组交换网络的存储-转发过程可以抽象为一个排队系统，基于排队论的分析发现，当分组具有相同的长度时，分组在交换过程中的延迟时间较小。因此，把报文按一定的标准长度分隔为“分组”，就能够使交换设备以分组为单位对信息进行处理，从而缩短信息在交换过程中的延迟时间，这正式产生分组交换方式的重要理论依据之一。  

理论分析发现，在其他条件相同的情况下，分组长度越长，延迟时间越长。  
所以，对于实时交互是通信，要求延迟时间短，分组长短应该尽可能短；对于注入文件传送类的非实时数据通信，延迟要求不高，即使分组长度较长，也不致影响正常通信，分组长度可以适当长写。  

当然，分组长度不宜太短，因为分组长度太短，就意味着一个报文需要拆分的分组数增加，而每个分组是需要附加控制信息的，额外开销会增加，有效数据传输效率会降低，因此，需要在延迟时间与开销之间进行平衡。另外，实际的分组交换网络的分组长度并不总是相同的，通常会规定一个分组长度范围，这样基友灵活性，又尽可能优化网络延时。  

#### 2、分组长度与误码率

通信链路的信道误码率是确定分组长度时另一个需要重点考虑的因素。  

设分组长度为 L 位，其中 h 位为分组头长度，数据长度为 x 位， 即： x+h=L  

若信道误码率为Pe，则分组传输正确的概论（只考虑分组中位五码的情况）为： Ps = (1 - Pe)^x+h  

分组传输错误要求重发的概率为（1 - Ps），在考虑可能多次连续传输错误的情况下，可以得到最佳分组长度 Lopt 为 ： Lopt = （h / Pe)^0.5  

最高信道利用率可以表示为： 我打不出来~~~~(>_<)~~~~  

此部分搞不懂，因为很多东西，得出以下结论：  

分组交换中必须具有差错控制，以提高传输数据的可靠性。  

目前，有关分组数据交换的规格和标准已经有国际电信联盟（International Telecom Union，ITU）以建议的形式制定出，分组长度以 16B（1B = 8 bit）到 4096 B 之间的 2^n B 为标准分组长度，如 32B、64B、256B、512B和1024B等。  


