# 第二章 网络应用 第三节 域名系统（DNS）

用户通常利用客户端软件来使用某个网络应用，例如：浏览器、邮件收发软件等，这些软件被称为用户代理（user agent）。  
用户通过用户代理软件使用网络应用时，需要指定期望访问服务器的 IP 地址与端口号。  
但是普通用户并不习惯或愿意记忆和直接使用 IP 地址来标识一个主机，而是更喜欢为服务器主机起一个更容易读懂的、有一定自然语言含义的名字，这个名字就是主机的域名（domain name）。  
大多数情况下，用户在使用网络应用时，都是在用户代理软件中输入服务器域名来指定要访问的服务器主机。  
然而，网络协议在通信时，必须使用 IP 地址，如何**将用户喜欢使用的域名映射为协议使用的 IP 地址**呢？  
这就是域名系统（Domain name System，DNS）的任务了。  

DNS 是一个重要的基础应用，因为任何一个需要使用域名进行通信的网络应用，在应用通信之前首先需要请求 DNS 应用，将域名映射为 IP 地址。  
**实现将域名映射为 IP 地址的过程，称为域名解析**  

DNS 为了实现域名解析，需要建立分布式数据库，存储网络中域名与 IP 地址的映射关系数据，这些数据库存储在域名服务器上，域名服务器根据用户的请求提供域名解析服务。  
DNS 作为分布式数据库，域名服务器分布在整个互联网上，每个域名服务器只存储了部分域名信息。   
为了完成域名解析，通常需要在多个域名服务器之间进行查询，因此，DNS 也必须定义相应的应用协议。  

## 一、层次化域名空间

DNS 为了实现域名的有效管理与高效查询， DNS 服务器按层次结构进行组织，并且该层次结构与域名的结构相对应。  
因特网采用了层次树状结构的命名方法。任何一个连接在因特网上的主机或路由器，都可以有一个唯一的层次结构的域名（当然，也可以不命名）。  
域名的结构由标号序列组成，标号之间用点隔开，例如：“···.三级域名.二级域名.顶级域名”，各标号分别代表不同级别的域名。  

1. 国家顶级域名 nTLD：如 cn 表示中国，us 表示美国，uk 表示英国等。  
2. 通用顶级域名 gTLD：最早的顶级域名是 com（公司和企业）、net（网络服务机构）、org（非盈利组织）、edu（专用的教育机构）、gov（专用的政府部门）、mil（专用的军事部门）、int（国际组织）。  
3. 基础结构域名（infrastructure domain）：这种顶级域名只有一个，即 arpa，用于反向域名解析，因此又称为反向域名。  

--------

## 二、域名服务器

***一个服务器所负责管辖的（或有权限的）范围叫做区（zone）。**  
每个区设置相应的权威域名服务器，用来保存该区中的所有主机的域名到 IP 地址的映射。  
DNS 服务器的管辖范围不是以“域”为单位的，而是以“区”为单位。  

域名服务器根据其主要保存的域名信息一级在域名解析过程中的作用等，可以分为**根域名服务器、顶级域名服务器、权威域名服务器、中间域名服务器** 4 类。  
另外，任何一台主机在网络地址配置时，都会配置一个域名服务器作为默认域名服务器，这样这台主机任何时候需要进行域名解析，都会将域名查询请求发送给该服务器；该服务器如果保存了被查询域名的信息，则直接作出响应，如果没有，则代理查询其他域名服务器，直到查询到结果，最后将查询结果发送给查询主机。  
这个默认域名服务器通常称为本地域名服务器，是主机进行域名查询过程中首先被查询的域名服务器。  

**根域名服务器是最重要的域名服务器。**  
全球互联网中部署了有限的几个根域名服务器，每个根域名服务器都知道所有的顶级域名服务器的域名和IP地址。  
不管哪一个本地域名服务器，若要对因特网上任何一个域名进行解析，只要自己无法解析，就首先求助于根域名服务器。  
在因特网上共有13个不同 IP 地址的根域名服务器，他们的名字是用一个英文字母命名，从 a 一直到 m （前13个字母），如：a.rootservers.net、...、m.rootservers.net。  

**顶级域名服务器**，即 TLD 服务器，负责管理在该顶级域名服务器注册的所有二级域名。  
顶级域名服务器的名称对应一个域名的最后一个名字，是对一个行业的命名，如 com、org等，或对一个区域的命名，如cn、us等。  

**权威域名服务器**，负责一个区的域名服务器，保存该区中所有主机的域名到 IP 地址的映射。  
任何一个拥有域名的主机，其域名与 IP 地址的映射关系等信息都存储在所在网络的权威域名服务器上。  
在进行域名解析时，只要查询到被查询域名主机注册的权威域名服务器，就可以获得该域名对应的 IP 地址信息。  

在层次域名结构中，有时还存在一些既不是根域名服务器，又不是顶级域名服务器，也不是权威域名服务器的域名服务器，这些域名服务器通常称为**中间域名服务器。**  
例如，某主机域名为 www.abc.xyz.com ，则可能存在的域名服务器包括顶级域名服务器 com，中间域名服务器 xyz.com，权威域名服务器 abc.xyz.com。  

--------

## 三、域名解析过程

**域名解析分为递归解析和迭代解析。**  
- **提供递归查询服务的域名服务器**,可以代替查询主机或其他域名服务器，进行进一步的域名查询，并将最终解析结果发送给查询主机或服务器。  
- **提供迭代查询的服务器**, 不会不会代替查询主机或其他域名服务器，进行进一步的查询，只是将下一步要查询的服务器告知查询主机或服务器（当然，如果该服务器拥有最终解析结果，则直接相应解析结果）。  

**通常本地域名服务器提供递归查询服务。**  
主机在进行域名查询时，本地域名服务器如果没有被查询域名的信息，则代理主机查询根域名服务器或其他服务器，直到得到被查询域名的 IP 地址（当然，也可能查询不到），最后将解析结果发送给主机。  

提供迭代查询服务的域名服务器不会代理客户的查询请求，而是将最终结果或者下一步要查询的域名服务器直接相应给查询客户。  
根域名服务器通常只提供迭代查询服务，档根域名服务器收到本地域名服务器的迭代查询请求报文时，妖魔给出索要查询的 IP 地址（这种情况不多见），要么在相应报文中告诉本地域名服务器下一步应当查询哪一个域名服务器，本地域名服务器则继续查询下一个域名服务器，知道查询到被查询域名主机的权威域名服务器。  

无论是递归解析还是迭代解析，在上述查询过程中，只要本地域名服务器不能直接响应解析结果，则都需要从根域名服务器开始查询。整个互联网上的根域名服务器数量有限，如果每次都去查询根域名服务器，则根域名服务器的压力很大，会严重影响查询响应时间和查询效率。  
所以需要一些策略和方案来改进域名系统的查询效率。典型策略之一是域名服务器增加缓存机制，即在为客户作出相应的同时，每个域名服务器都会将在域名解析过程中解析到的结果存储到域名数据库中，当再次收到相同域名信息的查询请求时，便可利用缓存的信息直接做查询相应，从而缩短域名查询相应时间。  
另外，还可以通过在本地域名服务器中存储顶级域名服务器信息，使得在域名解析过程中跳过根域名服务器的查询，直接查询顶级域名服务器，提高域名查询效率。  



